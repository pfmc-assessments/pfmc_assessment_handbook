<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Unofficial NWFSC and SWFSC Groundfish Stock Assessment Handbook - 1&nbsp; Data sources: notes, contact information, and links</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./02-model-choices.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01-data-sources.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Data sources: notes, contact information, and links</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Unofficial NWFSC and SWFSC Groundfish Stock Assessment Handbook</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/pfmc-assessments/pfmc_assessment_handbook" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-data-sources.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Data sources: notes, contact information, and links</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-model-choices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Modeling choices, notes and best practices</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-stock-synthesis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Running Stock Synthesis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-post-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">So you ran an assessment model, more notes and best practices</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-other.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Other useful tidbits</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cloud-computing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Cloud computing: jittering a stock assessment</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Species seen\* in the hake fishery</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Alaska Center CRUISEJOINS for shelf and slope surveys</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#table-of-contacts" id="toc-table-of-contacts" class="nav-link active" data-scroll-target="#table-of-contacts"><span class="header-section-number">1.1</span> Table of contacts</a></li>
  <li><a href="#requesting-data-from-state-partners" id="toc-requesting-data-from-state-partners" class="nav-link" data-scroll-target="#requesting-data-from-state-partners"><span class="header-section-number">1.2</span> Requesting data from State partners</a></li>
  <li><a href="#regulations-and-catch-limits" id="toc-regulations-and-catch-limits" class="nav-link" data-scroll-target="#regulations-and-catch-limits"><span class="header-section-number">1.3</span> Regulations and catch limits</a></li>
  <li><a href="#catch-data-lengths-ages-etc." id="toc-catch-data-lengths-ages-etc." class="nav-link" data-scroll-target="#catch-data-lengths-ages-etc."><span class="header-section-number">1.4</span> Catch data, lengths, ages, etc.</a>
  <ul class="collapse">
  <li><a href="#west-coast-groundfish-observer-program-wcgop" id="toc-west-coast-groundfish-observer-program-wcgop" class="nav-link" data-scroll-target="#west-coast-groundfish-observer-program-wcgop"><span class="header-section-number">1.4.1</span> West Coast Groundfish Observer Program (WCGOP)</a></li>
  <li><a href="#at-sea-hake-observer-program-ashop" id="toc-at-sea-hake-observer-program-ashop" class="nav-link" data-scroll-target="#at-sea-hake-observer-program-ashop"><span class="header-section-number">1.4.2</span> At-Sea Hake Observer Program (ASHOP)</a></li>
  <li><a href="#pacfin-biological-data-bds" id="toc-pacfin-biological-data-bds" class="nav-link" data-scroll-target="#pacfin-biological-data-bds"><span class="header-section-number">1.4.3</span> PacFIN biological data (BDS)</a></li>
  <li><a href="#pacfin-landings" id="toc-pacfin-landings" class="nav-link" data-scroll-target="#pacfin-landings"><span class="header-section-number">1.4.4</span> PacFIN landings</a></li>
  <li><a href="#recfin" id="toc-recfin" class="nav-link" data-scroll-target="#recfin"><span class="header-section-number">1.4.5</span> RecFIN</a></li>
  <li><a href="#research-catch" id="toc-research-catch" class="nav-link" data-scroll-target="#research-catch"><span class="header-section-number">1.4.6</span> Research catch</a></li>
  </ul></li>
  <li><a href="#indices-of-abundance" id="toc-indices-of-abundance" class="nav-link" data-scroll-target="#indices-of-abundance"><span class="header-section-number">1.5</span> Indices of abundance</a></li>
  <li><a href="#summary-of-noaa-fishery-independent-trawl-surveys-used-for-west-coast-assessments" id="toc-summary-of-noaa-fishery-independent-trawl-surveys-used-for-west-coast-assessments" class="nav-link" data-scroll-target="#summary-of-noaa-fishery-independent-trawl-surveys-used-for-west-coast-assessments"><span class="header-section-number">1.6</span> Summary of NOAA fishery independent trawl surveys used for west coast assessments</a>
  <ul class="collapse">
  <li><a href="#afsc-surveys" id="toc-afsc-surveys" class="nav-link" data-scroll-target="#afsc-surveys"><span class="header-section-number">1.6.1</span> AFSC surveys</a></li>
  <li><a href="#nwfsc-survey-indices" id="toc-nwfsc-survey-indices" class="nav-link" data-scroll-target="#nwfsc-survey-indices"><span class="header-section-number">1.6.2</span> NWFSC Survey Indices</a></li>
  <li><a href="#nwfsc-survey-length-and-age-compositions" id="toc-nwfsc-survey-length-and-age-compositions" class="nav-link" data-scroll-target="#nwfsc-survey-length-and-age-compositions"><span class="header-section-number">1.6.3</span> NWFSC Survey Length and Age Compositions</a></li>
  <li><a href="#iphc-survey" id="toc-iphc-survey" class="nav-link" data-scroll-target="#iphc-survey"><span class="header-section-number">1.6.4</span> IPHC survey</a></li>
  <li><a href="#oregon-recreational-observer-program-data" id="toc-oregon-recreational-observer-program-data" class="nav-link" data-scroll-target="#oregon-recreational-observer-program-data"><span class="header-section-number">1.6.5</span> Oregon recreational observer program data</a></li>
  </ul></li>
  <li><a href="#notes-and-best-practices-for-observer-data-and-discards" id="toc-notes-and-best-practices-for-observer-data-and-discards" class="nav-link" data-scroll-target="#notes-and-best-practices-for-observer-data-and-discards"><span class="header-section-number">1.7</span> Notes and best practices for observer data and discards</a>
  <ul class="collapse">
  <li><a href="#what-are-the-wcgop-data" id="toc-what-are-the-wcgop-data" class="nav-link" data-scroll-target="#what-are-the-wcgop-data"><span class="header-section-number">1.7.1</span> What are the WCGOP data?</a></li>
  <li><a href="#bootstrapping" id="toc-bootstrapping" class="nav-link" data-scroll-target="#bootstrapping"><span class="header-section-number">1.7.2</span> Bootstrapping</a></li>
  <li><a href="#requesting-discard-data" id="toc-requesting-discard-data" class="nav-link" data-scroll-target="#requesting-discard-data"><span class="header-section-number">1.7.3</span> Requesting discard data</a></li>
  <li><a href="#discard-rates-and-length-comps-from-the-pikitch-et-al.-discard-study-1985-87-and-mesh-study-1988-90-databases" id="toc-discard-rates-and-length-comps-from-the-pikitch-et-al.-discard-study-1985-87-and-mesh-study-1988-90-databases" class="nav-link" data-scroll-target="#discard-rates-and-length-comps-from-the-pikitch-et-al.-discard-study-1985-87-and-mesh-study-1988-90-databases"><span class="header-section-number">1.7.4</span> Discard rates, and length comps, from the Pikitch et al.&nbsp;Discard Study (1985-87) and Mesh Study (1988-90) databases</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/pfmc-assessments/pfmc_assessment_handbook/edit/main/01-data-sources.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/pfmc-assessments/pfmc_assessment_handbook/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Data sources: notes, contact information, and links</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="table-of-contacts" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="table-of-contacts"><span class="header-section-number">1.1</span> Table of contacts</h2>
<p>Contact info for various agencies (states, PacFIN, etc.) is listed in <a href="https://spreadsheets.google.com/ccc?key=0ApyEcf4KAlVTdDV0V1ZsNFM5REVzNDh4SXJGWkJydWc&amp;hl=en#gid=0">this Google Doc</a> created by Jason Cope in 2009 (updated May 2021)</p>
</section>
<section id="requesting-data-from-state-partners" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="requesting-data-from-state-partners"><span class="header-section-number">1.2</span> Requesting data from State partners</h2>
<p>Starting with the 2023 cycle, there is a more formal process for making data requests to states for stock assessments. Details about the data requesting process, and steps for assessment leads to take, can be found in the document “<a href="https://docs.google.com/document/d/1AndASdmB7gf47DODlljWb7YZNHIOgjzwHy2boUqsaL0/edit#heading=h.to89stblj2l0">Process for requesting data from states for 2023 cycle</a>.”</p>
</section>
<section id="regulations-and-catch-limits" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="regulations-and-catch-limits"><span class="header-section-number">1.3</span> Regulations and catch limits</h2>
<p>Jim Hastie has lived through many changes in regulations for west coast groundfish. Don Pearson has recently (Fall of 2014) created <a href="https://calcom.psmfc.org/regulation_main.asp">this online regulations database</a>.</p>
</section>
<section id="catch-data-lengths-ages-etc." class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="catch-data-lengths-ages-etc."><span class="header-section-number">1.4</span> Catch data, lengths, ages, etc.</h2>
<section id="west-coast-groundfish-observer-program-wcgop" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="west-coast-groundfish-observer-program-wcgop"><span class="header-section-number">1.4.1</span> West Coast Groundfish Observer Program (WCGOP)</h3>
<p>Jason Jannot says that it should be easier to request data this year, but we (or perhaps a few designated folks on the team) will get it in a more raw format that needs some processing. See section below on “Notes and best practices for observer data and discards” ADD LINK</p>
</section>
<section id="at-sea-hake-observer-program-ashop" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="at-sea-hake-observer-program-ashop"><span class="header-section-number">1.4.2</span> At-Sea Hake Observer Program (ASHOP)</h3>
<p>Vanessa Tuttle (<a href="mailto:Vanessa.Tuttle@noaa.gov">Vanessa.Tuttle@noaa.gov</a>) is the contact person for this. Unlike the shoreside subset of the hake fishery which has dockside sampling and bycatch reported in PacFIN, the observed bycatch in the at-sea sectors (motherships and catcher-processors) is reported to the NORPAC database housed at AFSC. A non-definitive list of “common” and “uncommon” species seen in the hake fishery (as of 2008, but Vanessa says it is still current as of 2022) is in <a href="appendix-a.html" class="quarto-xref">Appendix&nbsp;<span>A</span></a> of this document.</p>
</section>
<section id="pacfin-biological-data-bds" class="level3" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="pacfin-biological-data-bds"><span class="header-section-number">1.4.3</span> PacFIN biological data (BDS)</h3>
<p>Talk to John Wallace or Andi Stevens. To confirm sample sizes for BDS, go to <a href="http://pacfin.psmfc.org/pacfin_pub/data_rpts_pub/bds_table_stats_sp_subtotals.txt">this webpage</a> which should give a recent tally of samples by state agency.</p>
<p>Generalized code to process the data are currently in <a href="https://github.com/pfmc-assessments/PacFIN.Utilities">{PacFIN.Utilities}</a>.</p>
<p>You may see some discrepancies in CA data from 1985-1989 when compared to older extractions. Some samples were removed for some species. It is not clear why these samples were removed.</p>
</section>
<section id="pacfin-landings" class="level3" data-number="1.4.4">
<h3 data-number="1.4.4" class="anchored" data-anchor-id="pacfin-landings"><span class="header-section-number">1.4.4</span> PacFIN landings</h3>
<p><strong>[Add text here on how and where to get catch for <del>2019</del> 2023 assessments]</strong></p>
<p>Talk to John Wallace or Andi Stephens. Note that the PacFIN catch can be broken down by INPFC or month only for the trawl component, not the non-trawl gears. Also, beware double counting based on multiple levels of aggregation.</p>
<p>PSMFC areas do not contain all of the catch, thus it is best to use INPFC areas to aggregate catch.</p>
<p>Once you have catch values for all years, contact the state representative(s) for confirmation that the values are correct.</p>
</section>
<section id="recfin" class="level3" data-number="1.4.5">
<h3 data-number="1.4.5" class="anchored" data-anchor-id="recfin"><span class="header-section-number">1.4.5</span> RecFIN</h3>
<p>All states have in the past claimed that all rec. data is available on <a href="http://www.recfin.org/">RecFIN</a>. Users should check with state representatives for updated information on the recommended source for recreational data. One can pull historical catches <a href="http://www.recfin.org">here</a>. Select the “Catch / Sample Data Reports” image which takes you to the reports dashboard. Alternatively, ODBC connections can be used to pull catch estimates directly from the Comprehensive Fish Ticket table. Some data sources (e.g.&nbsp;MRFSS, WA historic catch estimates) are not currently available via the public login, so you need to login with an account that has permission to view the tables. Additionally, once you have catch values for all years, contact the state representative for confirmation that the values are correct.</p>
<p>Washington provides recreational catch in numbers. This leads to two decisions for putting catches into the model: keep catch in numbers, which stock synthesis converts to weights internally; or convert catch to weight using an external estimate. Both options have been done historically. The former causes challenges for projections, but if the former is chosen, it is useful to compare the model’s calculated average weight of the catch to the value used to convert numbers to weight to see if there is large disagreement. For a partial history about this issue, and approaches for some past assessments see <a href="https://github.com/pfmc-assessments/canary_2023/issues/52">issue #52</a> from the canary rockfish git hub page.</p>
<p>To obtain length composition data,</p>
<ol type="1">
<li>Go to <a href="https://www.recfin.org/">RecFIN</a></li>
<li>Select the “Catch / Sample Data Reports” image which takes you to the reports dashboard. There, select the “SD001 Biological Detail Report” option.</li>
<li>There is an automatic filtering applied, so to adjust select the ‘filter’ icon in the upper right (the upside down Erlenmeyer flask-like icon), and then download your data in either csv or excel format. Lengths come in imputed and measured, with T being total length and F being fork length. For questions on definitions of fields, the metadata is included as a selectable report in the reports dashboard.</li>
</ol>
<p>E.J. Dick (SWFSC) and Jason Edwards (PSMFC) are developing tables with catch-weighted length compositions. Tables have been prepared for WA and OR, and CA is in prep. Contact E.J. (<a href="edward.dick@noaa.gov">edward.dick@noaa.gov</a>) if you have questions or would like to use the estimates.</p>
</section>
<section id="research-catch" class="level3" data-number="1.4.6">
<h3 data-number="1.4.6" class="anchored" data-anchor-id="research-catch"><span class="header-section-number">1.4.6</span> Research catch</h3>
<p>This is not automatically included in any of the other data sources. Gretchen Hanshew (<a href="mailto:Gretchen.Hanshew@noaa.gov">Gretchen.Hanshew@noaa.gov</a>) has been the source in the past. Talk to John Wallace and <del>Ian Taylor</del> about complexities regarding PacFIN records of landings from research catch.</p>
</section>
</section>
<section id="indices-of-abundance" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="indices-of-abundance"><span class="header-section-number">1.5</span> Indices of abundance</h2>
<p>At a team meeting on 13 March 2019, the team agreed on the following terminology for the surveys, where best practice would be to introduce the survey initially using the full name, with the short name in parentheses, and then use the short name after that. This will be the approach used in the write-up of the surveys as well.</p>
<ul>
<li><p>NWFSC West Coast Groundfish Bottom Trawl Survey (WCGBT Survey)</p></li>
<li><p>AFSC/NWFSC West Coast Triennial Shelf Survey (Triennial Survey)</p></li>
<li><p>AFSC West Coast Slope Survey (AFSC Slope Survey)</p></li>
<li><p>NWFSC West Coast Slope Survey (NWFSC Slope Survey)</p></li>
<li><p>NWFSC Southern California Shelf Rockfish Hook and Line Survey (H&amp;L Survey)</p></li>
<li><p>NWFSC Integrated Acoustic and Trawl Survey of Pacific Hake (Acoustic Survey)</p></li>
</ul>
<p>Note: the names for the first 4 of these surveys in the <a href="https://github.com/pfmc-assessments/nwfscSurvey">{nwfscSurvey}</a> package are “NWFSC.Combo”, “Triennial”, “AFSC.Slope”, “NWFSC.Slope”. The H&amp;L and acoustic surveys are not currently available through that package.</p>
</section>
<section id="summary-of-noaa-fishery-independent-trawl-surveys-used-for-west-coast-assessments" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="summary-of-noaa-fishery-independent-trawl-surveys-used-for-west-coast-assessments"><span class="header-section-number">1.6</span> Summary of NOAA fishery independent trawl surveys used for west coast assessments</h2>
<ol type="1">
<li><p>Triennial Survey (1980–1992 &amp; 1995–2004)</p>
<ol type="a">
<li><p>early triennial (1980–1992, 55-366m, north of 36.8 (however the switch to north of 34.5 actually occurred in 1989))</p></li>
<li><p>late triennial (1995–2004, 55-500m, north of 34.5)</p></li>
<li><p>The 2007 Canary assessment (<a href="https://www.pcouncil.org/documents/2007/10/status-of-the-u-s-canary-rockfish-resource-in-2007-october-15-2007.pdf">Stewart, 2007</a>) seems to have been the first one to split the survey and includes info on justification (but there’s an ongoing debate about the need to split).</p></li>
<li><p>Must filter out water hauls and tows occurring outside the US EEZ (foreign tows)</p></li>
<li><p>Note that 1977 is always tossed out.</p></li>
<li><p>The 2005 and 2013 Shortspine Thornyhead assessments split the triennial into shallow vs.&nbsp;deep to create a single index from 1980-2004 for 55-366 m and a separate 366-500 m index for 1995-2004.</p></li>
</ol></li>
<li><p>AKFSC Slope Survey (1997-2001, 183–1280m, north of 34.5)</p>
<ol type="a">
<li><p>Years before 1997 surveyed small areas of the coast</p></li>
<li><p>Must filter out tows occurring outside the US EEZ</p></li>
</ol></li>
<li><p>NWFSC Slope Survey (1998-2002, 183-1280m, north of 34.5)</p></li>
<li><p>WCGBT Survey (2003-present, 55-1280m, entire US coast)</p>
<ol type="a">
<li><p>Starting in 2004, there’s a change in sampling intensity north and south of 34.5, so this strata boundary should be included (unless there’s some specific reason not to)</p></li>
<li><p>Note that there were changes in sampling intensity at 183 and 549 meters</p></li>
<li><p>This survey should be referenced as the “WCGBT Survey”</p></li>
</ol></li>
</ol>
<section id="afsc-surveys" class="level3" data-number="1.6.1">
<h3 data-number="1.6.1" class="anchored" data-anchor-id="afsc-surveys"><span class="header-section-number">1.6.1</span> AFSC surveys</h3>
<p>Data are now available through the NWFSC data warehouse which can be accessed by the functions in the <a href="https://github.com/pfmc-assessments/nwfscSurvey">{nwfscSurvey}</a> package. <a href="appendix-b.html" class="quarto-xref">Appendix&nbsp;<span>B</span></a> identifies which year the listed vessels participated in the Triennial and Slope Surveys. Each cruise is assigned a unique number which is contained within the ‘CRUISEJOINS’ column in the database. Checking that your data has all the cruises you expect for a given survey would be good practice. Although gear and personnel change over time, if a study looking at differences by vessel was undertaken, <a href="appendix-b.html" class="quarto-xref">Appendix&nbsp;<span>B</span></a> shows which vessels participated in what year and survey.</p>
<section id="more-detail-on-these-afsc-surveys" class="level4" data-number="1.6.1.1">
<h4 data-number="1.6.1.1" class="anchored" data-anchor-id="more-detail-on-these-afsc-surveys"><span class="header-section-number">1.6.1.1</span> More detail on these AFSC surveys</h4>
<p>The the most recent RACE division species and data codes manuals are <a href="https://www.fisheries.noaa.gov/resource/document/groundfish-survey-species-code-manual-and-data-codes-manual">here</a>.</p>
<p>The ADP Code Book has, for example, sex and performance code information. For convenience, here is the legacy coding for sex:</p>
<blockquote class="blockquote">
<p>Sex</p>
<p>1 Male</p>
<p>2 Female</p>
<p>3 Undetermined</p>
</blockquote>
<p>Note on design of the 2004 Triennial Survey</p>
<blockquote class="blockquote">
<p>It is my (John Wallace) understanding that in the later years of Triennial survey (pre-2004), the survey became more of a fixed survey design as the skippers went back to the same locations as recorded on their vessel’s instrumentation.</p>
<p>For the 2004 survey, I followed the design as put forth in:</p>
<p><a href="https://docs.google.com/a/noaa.gov/document/d/1WnWF60l9GgB7ZwFeds7RYbddXMNmxxR6FAvB2Q4unPY/edit?usp=sharing">2001 AFSC Triennial Survey Plan (converted from WordPerfect via Word)</a></p>
<p>without regard to any previously recorded tow locations.</p>
<p>For CRUISEJOIN info, see <a href="appendix-b.html" class="quarto-xref">Appendix&nbsp;<span>B</span></a>.</p>
</blockquote>
</section>
</section>
<section id="nwfsc-survey-indices" class="level3" data-number="1.6.2">
<h3 data-number="1.6.2" class="anchored" data-anchor-id="nwfsc-survey-indices"><span class="header-section-number">1.6.2</span> NWFSC Survey Indices</h3>
<p>Tech memo on “history, design, and description” of the survey is now available:</p>
<blockquote class="blockquote">
<p><a href="https://www.nwfsc.noaa.gov/assets/25/8655_02272017_093722_TechMemo136.pdf">https://www.nwfsc.noaa.gov/assets/25/8655_02272017_093722_TechMemo136.pdf<br>
</a>Keller, A. A., J. R. Wallace, and R. D. Methot. 2017. The Northwest Fisheries Science Center’s West Coast Groundfish Bottom Trawl Survey: History, Design, and Description. U.S. Department of Commerce, NOAA Technical Memorandum NMFS-NWFSC-136. DOI: 10.7289/V5/TM-NWFSC-136.</p>
</blockquote>
<p>Additional information on the survey can be found in these documents from John Wallace:</p>
<blockquote class="blockquote">
<p><a href="https://docs.google.com/a/noaa.gov/document/d/1pq7D6ZYbpbgc-7v2qwcCyr3SCqDfBNxcPPq082jwnYQ/edit?usp=sharing">Strata Tow Percentages for NWFSC Bottom Trawl Survey for 2004-Current</a></p>
<p><a href="https://drive.google.com/a/noaa.gov/file/d/0B5YpOk8zQ3cuYWpSNEQ5XzZUMlk/edit?usp=sharing">Calcs for Strata Tow Percentages and Station Selection for the NWFSC Bottom Trawl Surveys for 2003 and Beyond (PDF file on Google Drive)</a></p>
</blockquote>
<p>Index standardization is used Kelli Johnson’s <a href="https://github.com/pfmc-assessments/VASTWestCoast">VAST wrapper</a> has specific examples for each survey located in the inst\examples folder.</p>
</section>
<section id="nwfsc-survey-length-and-age-compositions" class="level3" data-number="1.6.3">
<h3 data-number="1.6.3" class="anchored" data-anchor-id="nwfsc-survey-length-and-age-compositions"><span class="header-section-number">1.6.3</span> NWFSC Survey Length and Age Compositions</h3>
<p><a href="https://github.com/pfmc-assessments/nwfscSurvey">{nwfscSurvey}</a> package is used for comp data and other data explorations.</p>
<p>Scaling from Tow to Stratum Level: Weight normalized length or age comps for each tow by the numerical CPUE. This is done in the standard data package we get from Beth.</p>
<p>Scaling from Stratum to Coastwide (or Assessment Area) level: Weight strata length or age comps by numerical index for each strata (from GLMM). This may mean dividing the biomass index for each stratum by the average weight in that stratum (likely estimated from the length comp in that stratum).</p>
<section id="filtering-recorded-catches-that-are-fish-stuck-in-net-from-previous-tow" class="level4" data-number="1.6.3.1">
<h4 data-number="1.6.3.1" class="anchored" data-anchor-id="filtering-recorded-catches-that-are-fish-stuck-in-net-from-previous-tow"><span class="header-section-number">1.6.3.1</span> Filtering recorded catches that are fish stuck in net from previous tow</h4>
<p>In some cases, fish caught in one tow remain in the net until the next tow and are recorded as caught in that second tow (despite the attempts of the people on the survey to identify and exclude such fish from the data). While we plan to come up with a consistent way to deal with this, it has not been dealt with yet.</p>
<p>One problem arising from this is catch data outside of the depth range of the species. To identify the depth range, one can start with the deepest/shallowest tow with a positive record for that species and then look to see if the previous tow conducted by that vessel (likely on the same date) caught that species. If so, and if a small number or a small relative number of that fish species were recorded in the second tow, one can assume that those were from the previous tow. By moving sequentially until one reaches a depth range where a few clearly legitimate tows occurred, one can define a reasonable depth range.</p>
<p>A second phase would be to define a way to filter all the tows to remove likely candidates. A simple way to do this is to look at the range of catch levels that were determined to be not legitimate, and filter the whole data set for that species by removing all tows with catches below some quantile of those catch levels (say 80 or 90%). This will eliminate having a large number of small catches in the database used for the GLMM, which would skew the modeled distribution.</p>
</section>
</section>
<section id="iphc-survey" class="level3" data-number="1.6.4">
<h3 data-number="1.6.4" class="anchored" data-anchor-id="iphc-survey"><span class="header-section-number">1.6.4</span> IPHC survey</h3>
<p>This survey has been used for Yelloweye Rockfish and Spiny Dogfish. Claude Dykstra (<a href="mailto:claude@iphc.int">claude@iphc.int</a>) has provided data in the past. The index was calculated using a binomial GLM developed by John Wallace. Talk to John or Ian Taylor to get R code for this analysis.</p>
</section>
<section id="oregon-recreational-observer-program-data" class="level3" data-number="1.6.5">
<h3 data-number="1.6.5" class="anchored" data-anchor-id="oregon-recreational-observer-program-data"><span class="header-section-number">1.6.5</span> Oregon recreational observer program data</h3>
<p>Troy Buell (<a href="mailto:troy.v.buell@state.or.us">troy.v.buell@state.or.us</a>) is still involved with this data source even though he has changed positions.</p>
</section>
</section>
<section id="notes-and-best-practices-for-observer-data-and-discards" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="notes-and-best-practices-for-observer-data-and-discards"><span class="header-section-number">1.7</span> Notes and best practices for observer data and discards</h2>
<p>Discard mortality by fleet should be accounted for within the assessment. To obtain estimates of total discards based on the fleet structure in the model (gear and/or area) see the Groundfish Expanded Multi-year Mortality (GEMM) report which is a component of the annual Groundfish Mortality Report. The GEMM provides annual estimates of landed and discarded fish by sector off the West Coast starting in 2002 - present. However, the GEMM will not include the most full recent year estimates (example - the GEMM available in 2019 has data through 2017) which will require an assumption regarding the most recent year’s discards. Additionally, assumptions will need to be made regarding the total amount of discard prior to the start of the WCGOP data (pre-2002).</p>
<p>The GEMM report is produced by the WGCOP team with Dr.&nbsp;Kayleigh Somers (<a href="mailto:kayleigh.somers@noaa.gov">kayleigh.somers@noaa.gov</a>) as the lead author and is published in the September Council meeting Briefing Book titled the “Groundfish Mortality Report”. The GEMM can be found within the associated Excel spreadsheet on the Table 3 tab. Additionally, the GEMM can be accessed via two other methods: 1) the GEMM report is archived on the network under \Assessments\GEMM Report or 2) can be accessed using the <a href="https://github.com/pfmc-assessments/nwfscSurvey">{nwfscSurvey}</a> using the <code>pull_gemm()</code> function.</p>
<p>There are typically three common methods used within West Coast groundfish stock assessments to incorporate discard mortality.</p>
<p>The first approach is to include discard mortality into the catch data rather than estimating discards within the model. Discard mortality can be included by either adding this total to the catch by fleet or by adding a discard fleet. If using the discard fleet the selectivity of this fleet will need to be mirrored (see the 2017 California Blue/Deacon assessment for an example of this approach).</p>
<p>The second and third alternative approaches to including discard data is to model the process of discarding within SS3. Discards can be modeled either as total discards in mt or through the rate of discarding. Both of these approaches will require discard length data to be included in the model, or if not available a specific assumption regarding the retention curve relative to the estimated selectivity curve.</p>
<p>Estimates of total discards are available in the annual groundfish mortality report (and the GEMM). If a specific breakdown of discard by fleet is required (gear and/or area) speak with Dr.&nbsp;Kayleigh Somers. The data may not be able to be summarized to all fleet structures, so it is best to discuss the options with Kayleigh early in the assessment process. Assumptions regarding the discard total in the most recent year and historical years prior to the start of WCGOP data (2002) will need to be made by the assessor and modeled (often through the use of time blocks). If total discards are modeled, one will need to enter an annual CV into SS3 which is currently not available with the GEMM. The current approach for obtaining discard totals or discard rates with CV is via bootstrapping the available WCGOP observer data. The bootstrap CV will be based on the observer data and may not be entirely consistent with the data available in the groundfish mortality report (and the GEMM), particularly for sectors with limited observer coverage. Please see below for additional information regarding bootstrapping.</p>
<p>Modeling discard rates can be an easier approach since it does not require knowledge about the total discard amounts. However, this approach may not be feasible for stocks with limited observations in the WCGOP data due to high variability in the observed discarded and retained fish. The IFQ trawl fleet currently has near 100% observer coverage starting in 2011, while the non-catch share sectors have a much lower observed percentage (~20% as of last inquiry, but this may change in the future). Historically, it was thought that discard rates could not be calculated for complex managed species. However, this is not the case based on the current data. Discard rates are calculated based on the observed discarded weight relative to the total observed weight of discarded and retained fish. Bootstrapping is done using the data in order to provide a CV to the discard rate. Similar to two previous approaches, assumptions regarding the discard rate in the most recent year and historical years prior to the start of WCGOP data (2002) will need to be made by the assessor and modeled (often through the use of time blocks).</p>
<p>Note, if discard mortality is estimated within the model, it is important to compare the catches (landings + discards) estimated within SS3 to the total mortality estimates from the GEMM. The GEMM is the official mortality report for West Coast groundfish stocks as is used to determine the ACL and OFL attainment and if overfishing is occurring. The total mortality estimates between SS3 and the GEMM would not be expected to match exactly, however, the should have a reasonable level of similarity. If there are large differences between the mortality estimates across multiple years one may need to reconsider if the model has enough data to appropriately estimate retention reliably for each fleet.</p>
<p>The SSC has specified that the GEMM is the official data source to update recent removals when conducting a catch-only update model. The GMT is currently tasked with allocating removals by modeled fleet using the GEMM. The GMT will provide the removal estimates for year with GEMM data, provide expected removals for the final model year, and removal assumptions to use during the projection period. These data will typically be available between March and April of the assessment year.</p>
<p>Finally, the GEMM includes recreational mortality by state. These values are not estimated by WCGOP but rather are pulled directly from RecFIN since WCGOP does not observe recreational fisheries.</p>
<section id="what-are-the-wcgop-data" class="level3" data-number="1.7.1">
<h3 data-number="1.7.1" class="anchored" data-anchor-id="what-are-the-wcgop-data"><span class="header-section-number">1.7.1</span> What are the WCGOP data?</h3>
<p>The WCGOP database includes only data collected by observers on West Coast vessels. The data available in this database varies fairly dramatically based on the sector. The IFQ vessels essentially have 100% observer coverage, so the database includes a comprehensive view of discards and retained catch from observers for that sector. However, other sectors have a much lower percentage of observer coverage (<a href="https://www.nwfsc.noaa.gov/research/divisions/fram/observation/data_products/sector_products.cfm#ob">see the observer coverage</a>). As an example, the nearshore fishery generally has about 20% observer coverage. Only the observations made on that percentage of vessels are going to be available in the WCGOP database. Hence, the observed retained and discard amounts are going to be a significant underestimate of total mortality in that sector. The discard ratio will also be more variable, but could generally be representative of the discarding behavior.</p>
</section>
<section id="bootstrapping" class="level3" data-number="1.7.2">
<h3 data-number="1.7.2" class="anchored" data-anchor-id="bootstrapping"><span class="header-section-number">1.7.2</span> Bootstrapping</h3>
<p>The current approach to obtain uncertainty around the data in the WCGOP database, either the total discard or discard rates, is to bootstrap the data. These data are summarized and the observations bootstrapped to obtain uncertainty estimated based on gear and area stratification requested by the assessor. Chantel Wetzel (<a href="mailto:chantel.wetzel@noaa.gov">chantel.wetzel@noaa.gov</a>) currently conducts the bootstrap analysis.</p>
</section>
<section id="requesting-discard-data" class="level3" data-number="1.7.3">
<h3 data-number="1.7.3" class="anchored" data-anchor-id="requesting-discard-data"><span class="header-section-number">1.7.3</span> Requesting discard data</h3>
<p>There are two types of discard data available using WCGOP data. The first is a summary of the observed discards, discard rates, and bootstrapped uncertainty across years (2002 - present). The second type of data are lengths of discarded fish observed by WCGOP. To request these data please email information regarding data stratification (gear groupings and areas) to Chantel Wetzel (<a href="mailto:chantel.wetzel@noaa.gov">chantel.wetzel@noaa.gov</a>) for observed discards, rates, and uncertainty and Andi Stephens (<a href="mailto:andi.stephens@noaa.gov">andi.stephens@noaa.gov</a>) for length composition data for discarded fish.</p>
</section>
<section id="discard-rates-and-length-comps-from-the-pikitch-et-al.-discard-study-1985-87-and-mesh-study-1988-90-databases" class="level3" data-number="1.7.4">
<h3 data-number="1.7.4" class="anchored" data-anchor-id="discard-rates-and-length-comps-from-the-pikitch-et-al.-discard-study-1985-87-and-mesh-study-1988-90-databases"><span class="header-section-number">1.7.4</span> Discard rates, and length comps, from the Pikitch et al.&nbsp;Discard Study (1985-87) and Mesh Study (1988-90) databases</h3>
<p>If enough data exists, discard rates and length comps from the Pikitch et al.&nbsp;Discard Study database (or Mesh Study if no data exists in the Discard Study) may be obtained for a species to be assessed from John Wallace. Optionally, these rates can be expanded out to the surrounding years based on applying the study rates to PacFIN catch from the expanded years. This, of course, is only reasonable when the assumption of no significant changes to the fishery is a good one. For those in NOAA a draft of the methods paper can be downloaded <a href="https://drive.google.com/drive/folders/1RKexGwgWtY8m5wb7IHwfUmNeGyHDTP5B">here</a> (for non-NOAA folks that are interested, contact the author at john.wallace@noaa.gov).</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/pfmc-assessments\.github\.io\/pfmc_assessment_handbook\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link" aria-label="Preface">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Preface</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./02-model-choices.html" class="pagination-link" aria-label="Modeling choices, notes and best practices">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Modeling choices, notes and best practices</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/pfmc-assessments/pfmc_assessment_handbook/edit/main/01-data-sources.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/pfmc-assessments/pfmc_assessment_handbook/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>